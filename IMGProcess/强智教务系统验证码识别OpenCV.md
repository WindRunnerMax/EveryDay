# å¼ºæ™ºæ•™åŠ¡ç³»ç»ŸéªŒè¯ç è¯†åˆ« OpenCV

> å¼ºæ™ºæ•™åŠ¡ç³»ç»ŸéªŒè¯ç éªŒè¯ç å­—ç¬¦ä½ç½®ç›¸å¯¹å›ºå®šï¼Œæ¯”è¾ƒå¥½åˆ‡å‰²
> æ‰¾å‡†åˆ‡å‰²ä½ç½®ï¼Œå°†å…¶åˆ†ä¸ºå››éƒ¨åˆ†ï¼ŒåŒ¹é…è‡ªå»ºåº“å³å¯ï¼Œè¯†åˆ«ç‡è¿‘ä¹100%ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œç‚¹ä¸ªstarå§ ğŸ˜ƒ
> https://github.com/WindrunnerMax/SWVerifyCode æä¾›Javaã€PHPã€Pythonã€JavaScriptç‰ˆæœ¬

é¦–å…ˆä½¿ç”¨ä»£ç åˆ‡å‰²éªŒè¯ç ï¼ŒæŒ‘é€‰å‡ºåˆ‡å‰²çš„æ¯”è¾ƒå¥½çš„éªŒè¯ç ï¼Œåˆ¶ä½œæ¯”å¯¹åº“
ç”±äºä½¿ç”¨`matchTemplate`å‡½æ•°ï¼Œè¦æ±‚å¾…åŒ¹é…å›¾å¿…é¡»æ¯”åº“å›¾å°ï¼Œäºæ˜¯éœ€è¦æ”¾å¤§åº“å›¾è¾¹ç•Œ

`TestImgCut.py`åˆ‡å‰²å›¾ç‰‡å¹¶æŒ‘é€‰åˆé€‚åˆ‡å‰²ä½ç½®

```python
#!/usr/bin/python 
# -*- coding: utf-8 -*-

from fnmatch import fnmatch
from queue import Queue
import matplotlib.pyplot as plt
import cv2
import time
import os
from Convert import Convert
import requests



def _get_static_binary_image(img, threshold = 140):
  '''
  æ‰‹åŠ¨äºŒå€¼åŒ–
  '''

  img = Image.open(img)
  img = img.convert('L')
  pixdata = img.load()
  w, h = img.size
  for y in range(h):
    for x in range(w):
      if pixdata[x, y] < threshold:
        pixdata[x, y] = 0
      else:
        pixdata[x, y] = 255

  return img


def cfs(im,x_fd,y_fd):
  '''ç”¨é˜Ÿåˆ—å’Œé›†åˆè®°å½•éå†è¿‡çš„åƒç´ åæ ‡ä»£æ›¿å•çº¯é€’å½’ä»¥è§£å†³cfsè®¿é—®è¿‡æ·±é—®é¢˜
  '''

  # print('**********')

  xaxis=[]
  yaxis=[]
  visited =set()
  q = Queue()
  q.put((x_fd, y_fd))
  visited.add((x_fd, y_fd))
  offsets=[(1, 0), (0, 1), (-1, 0), (0, -1)]#å››é‚»åŸŸ

  while not q.empty():
      x,y=q.get()

      for xoffset,yoffset in offsets:
          x_neighbor,y_neighbor = x+xoffset,y+yoffset

          if (x_neighbor,y_neighbor) in (visited):
              continue  # å·²ç»è®¿é—®è¿‡äº†

          visited.add((x_neighbor, y_neighbor))

          try:
              if im[x_neighbor, y_neighbor] == 0:
                  xaxis.append(x_neighbor)
                  yaxis.append(y_neighbor)
                  q.put((x_neighbor,y_neighbor))

          except IndexError:
              pass
  # print(xaxis)
  if (len(xaxis) == 0 | len(yaxis) == 0):
    xmax = x_fd + 1
    xmin = x_fd
    ymax = y_fd + 1
    ymin = y_fd

  else:
    xmax = max(xaxis)
    xmin = min(xaxis)
    ymax = max(yaxis)
    ymin = min(yaxis)
    #ymin,ymax=sort(yaxis)

  return ymax,ymin,xmax,xmin

def detectFgPix(im,xmax):
  '''æœç´¢åŒºå—èµ·ç‚¹
  '''

  h,w = im.shape[:2]
  for y_fd in range(xmax+1,w):
      for x_fd in range(h):
          if im[x_fd,y_fd] == 0:
              return x_fd,y_fd

def CFS(im):
  '''åˆ‡å‰²å­—ç¬¦ä½ç½®
  '''

  zoneL=[]#å„åŒºå—é•¿åº¦Låˆ—è¡¨
  zoneWB=[]#å„åŒºå—çš„Xè½´[èµ·å§‹ï¼Œç»ˆç‚¹]åˆ—è¡¨
  zoneHB=[]#å„åŒºå—çš„Yè½´[èµ·å§‹ï¼Œç»ˆç‚¹]åˆ—è¡¨

  xmax=0#ä¸Šä¸€åŒºå—ç»“æŸé»‘ç‚¹æ¨ªåæ ‡,è¿™é‡Œæ˜¯åˆå§‹åŒ–
  for i in range(10):

      try:
          x_fd,y_fd = detectFgPix(im,xmax)
          # print(y_fd,x_fd)
          xmax,xmin,ymax,ymin=cfs(im,x_fd,y_fd)
          L = xmax - xmin
          H = ymax - ymin
          zoneL.append(L)
          zoneWB.append([xmin,xmax])
          zoneHB.append([ymin,ymax])

      except TypeError:
          return zoneL,zoneWB,zoneHB

  return zoneL,zoneWB,zoneHB


def cutting_img(im,im_position,xoffset = 1,yoffset = 1):
    # è¯†åˆ«å‡ºçš„å­—ç¬¦ä¸ªæ•°
    im_number = len(im_position[1])
    if(im_number>=4): im_number = 4;

    imgArr = []
    # åˆ‡å‰²å­—ç¬¦
    for i in range(im_number):
        im_start_X = im_position[1][i][0] - xoffset
        im_end_X = im_position[1][i][1] + xoffset
        im_start_Y = im_position[2][i][0] - yoffset
        im_end_Y = im_position[2][i][1] + yoffset
        cropped = im[im_start_Y:im_end_Y, im_start_X:im_end_X]
        imgArr.append(cropped)
        cv2.imwrite(str(i)+"v.jpg",cropped) # æŸ¥çœ‹åˆ‡å‰²æ•ˆæœ
    return im_number,imgArr



def main():
    cvt = Convert()
    req = requests.get("http://XXXXXXXXXXXXXXXXXXX/verifycode.servlet")
    img = cvt.run(req.content)
    cv2.imwrite("v.jpg",img)

    #åˆ‡å‰²çš„ä½ç½®
    im_position = CFS(img) # Auto

    print(im_position)

    maxL = max(im_position[0])
    minL = min(im_position[0])

    # å¦‚æœæœ‰ç²˜è¿å­—ç¬¦ï¼Œå¦‚æœä¸€ä¸ªå­—ç¬¦çš„é•¿åº¦è¿‡é•¿å°±è®¤ä¸ºæ˜¯ç²˜è¿å­—ç¬¦ï¼Œå¹¶ä»ä¸­é—´è¿›è¡Œåˆ‡å‰²
    if(maxL > minL + minL * 0.7):
        maxL_index = im_position[0].index(maxL)
        minL_index = im_position[0].index(minL)
        # è®¾ç½®å­—ç¬¦çš„å®½åº¦
        im_position[0][maxL_index] = maxL // 2
        im_position[0].insert(maxL_index + 1, maxL // 2)
        # è®¾ç½®å­—ç¬¦Xè½´[èµ·å§‹ï¼Œç»ˆç‚¹]ä½ç½®
        im_position[1][maxL_index][1] = im_position[1][maxL_index][0] + maxL // 2
        im_position[1].insert(maxL_index + 1, [im_position[1][maxL_index][1] + 1, im_position[1][maxL_index][1] + 1 + maxL // 2])
        # è®¾ç½®å­—ç¬¦çš„Yè½´[èµ·å§‹ï¼Œç»ˆç‚¹]ä½ç½®
        im_position[2].insert(maxL_index + 1, im_position[2][maxL_index])

    # åˆ‡å‰²å­—ç¬¦ï¼Œè¦æƒ³åˆ‡å¾—å¥½å°±å¾—é…ç½®å‚æ•°ï¼Œé€šå¸¸ 1 or 2 å°±å¯ä»¥
    cutting_img_num,imgArr = cutting_img(img,im_position,1,1)

    # # ç›´æ¥ä½¿ç”¨åº“è¯»å–å›¾ç‰‡è¯†åˆ«éªŒè¯ç  
    # result=""
    # for i in range(cutting_img_num):
    #     try:
    #       template = imgArr[i]
    #       tempResult=""
    #       matchingDegree=0.0
    #       filedirWarehouse = '../../Warehouse/StrIntell/'
    #       for fileImg in os.listdir(filedirWarehouse):
    #         if fnmatch(fileImg, '*.jpg'):
    #           # print(file)
    #           img = cv2.imread(filedirWarehouse+fileImg,0)
    #           res = cv2.matchTemplate(img,template,3) #imgåŸå›¾ templateæ¨¡æ¿   ç”¨æ¨¡æ¿åŒ¹é…åŸå›¾
    #           min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(res)
    #           # print(str(i)+" "+file.split('.')[0]+" "+str(max_val))
    #           if(max_val>matchingDegree):
    #             tempResult=fileImg.split('.')[0]
    #             matchingDegree=max_val
    #       result+=tempResult
    #       matchingDegree=0.0
    #     except Exception as err:
    #       print("ERROR "+ str(err))
    #       pass
    # print('åˆ‡å›¾ï¼š%s' % cutting_img_num)
    # print('è¯†åˆ«ä¸ºï¼š%s' % result)



if __name__ == '__main__':
  main()
```

`resize.py`æ”¹å˜å›¾ç‰‡è¾¹ç•Œ

```python
import cv2
from fnmatch import fnmatch
import os
 
def main():
    filedir = './StrIntell'
    for file in os.listdir(filedir):
        if fnmatch(file, '*.jpg'):
            fileLoc=filedir+"/"+file
            img=cv2.imread(fileLoc)
            # img=cv2.copyMakeBorder(img,10,10,10,10,cv2.BORDER_CONSTANT,value=[255,255,255]) # æ‰©å¤§
            # img = img[0:25, 0:25] # è£å‰ª é«˜*å®½
            print(img.shape)
            cv2.imwrite(fileLoc, img)
 
if __name__ == '__main__':
    main()

```
æŒ‘é€‰å¥½åˆé€‚çš„åº“å›¾ç‰‡å¹¶å°†å…¶resize
ä½¿ç”¨`TestImgCut.py`ç›´æ¥è¯»åº“è¯†åˆ«éªŒè¯ç 
æ ¹æ®æ•ˆæœæŒ‘é€‰åˆé€‚çš„åˆ‡å‰²ä½ç½®å¹¶ä¿å­˜èµ·æ¥
å½“è§‰å¾—åº“æ–‡ä»¶ä¸åˆ‡å‰²ä½ç½®åˆé€‚ï¼Œå°†å›¾ç‰‡è½¬ä¸º`list`å¹¶ä¿å­˜åœ¨å˜é‡
ä¿å­˜åœ¨å˜é‡çš„ä¸»è¦ç›®çš„æ˜¯å¯ä»¥ç›´æ¥è¯»å–åˆ°å†…å­˜ï¼Œé¿å…é¢‘ç¹è¯»ç¡¬ç›˜é€ æˆæ—¶é—´æµªè´¹

`binary.py`è½¬å­—ç¬¦ä¸ºå˜é‡

```python
import cv2
import os
from fnmatch import fnmatch
import numpy as np
np.set_printoptions(threshold=np.inf) # ä¸çœç•¥è¾“å‡º

if __name__ == '__main__':
    binary = ""
    for fileImg in os.listdir("StrIntell/"):
        if fnmatch(fileImg, '*.jpg'):
          img = cv2.imread("StrIntell/"+fileImg,0)
          binary = binary + "'" +fileImg.split(".")[0] + "'" + ":" + str(img.tolist()) + ","
          # cv2.imwrite("test.jpg", np.array(img.tolist()))
    binary = "charMap = {" + binary + "}" 
    with open("CharMap.py",'w+') as f: 
        f.write(binary)
          
```

`CharMap.py`å­—ç¬¦å˜é‡

```python
charMap = {'1':[[255, 255, 254, 254, 255, 251, 254, 255, 254, 253, 254, 255, 255], [252, 254, 251, 255, 255, 254, 255, 255, 254, 253, 254, 255, 255], [255, 249, 255, 252, 248, 255, 250, 255, 252, 252, 253, 254, 254], [253, 255, 250, 255, 249, 255, 1, 0, 251, 252, 253, 253, 254], [253, 255, 250, 253, 5, 1, 3, 0, 253, 254, 254, 254, 253], [254, 251, 255, 253, 0, 0, 5, 2, 253, 255, 255, 254, 253], [254, 254, 250, 255, 252, 254, 2, 0, 251, 253, 255, 255, 254], [254, 250, 255, 255, 255, 254, 3, 5, 250, 252, 254, 254, 254], [255, 255, 248, 255, 249, 254, 2, 0, 255, 255, 255, 253, 255], [252, 255, 251, 255, 255, 253, 1, 0, 254, 255, 253, 254, 255], [255, 251, 254, 255, 250, 254, 2, 0, 255, 255, 252, 253, 251], [253, 255, 252, 253, 248, 253, 0, 6, 255, 251, 254, 252, 251], [255, 250, 255, 249, 255, 255, 0, 2, 250, 255, 253, 255, 254], [254, 255, 253, 255, 0, 0, 2, 1, 1, 2, 254, 251, 255], [254, 254, 247, 255, 0, 3, 3, 0, 3, 3, 254, 251, 254], [252, 253, 255, 252, 255, 255, 251, 255, 254, 254, 253, 255, 252], [255, 255, 255, 249, 255, 253, 255, 252, 255, 255, 252, 251, 254]],'2':[[249, 255, 251, 254, 255, 253, 253, 253, 255, 255, 252, 251, 255], [255, 253, 255, 251, 249, 255, 254, 255, 252, 253, 255, 255, 253], [253, 254, 252, 255, 254, 253, 255, 253, 253, 255, 250, 252, 255], [254, 255, 252, 2, 0, 3, 1, 0, 255, 255, 253, 254, 255], [254, 252, 5, 0, 2, 0, 3, 1, 3, 249, 253, 255, 254], [254, 255, 254, 249, 251, 251, 253, 253, 4, 1, 254, 255, 251], [255, 254, 251, 255, 251, 255, 255, 250, 0, 4, 253, 251, 254], [255, 250, 251, 252, 255, 246, 253, 254, 9, 2, 252, 255, 251], [248, 255, 253, 252, 255, 255, 255, 5, 0, 254, 253, 254, 255], [253, 255, 251, 255, 252, 0, 0, 0, 255, 251, 255, 251, 255], [255, 250, 252, 255, 1, 2, 255, 253, 250, 255, 252, 255, 250], [254, 253, 255, 0, 6, 255, 247, 255, 252, 255, 252, 251, 255], [254, 255, 2, 2, 0, 250, 255, 253, 251, 254, 253, 252, 255], [254, 254, 3, 2, 1, 1, 5, 1, 3, 1, 255, 253, 252], [252, 251, 1, 3, 0, 3, 0, 4, 7, 1, 252, 254, 255], [254, 255, 255, 255, 255, 255, 255, 253, 252, 255, 254, 255, 253], [252, 255, 255, 255, 253, 255, 251, 253, 255, 255, 251, 255, 254]],'3':[[255, 253, 253, 255, 255, 253, 251, 255, 254, 253, 255, 255, 250], [255, 253, 251, 255, 255, 254, 253, 249, 255, 254, 253, 255, 254], [253, 251, 255, 252, 252, 255, 254, 255, 255, 254, 253, 252, 253], [255, 253, 249, 253, 255, 0, 4, 0, 0, 0, 255, 255, 252], [254, 255, 255, 250, 3, 3, 0, 6, 4, 0, 0, 255, 254], [254, 255, 255, 253, 252, 255, 252, 252, 253, 3, 0, 254, 255], [255, 250, 255, 255, 252, 253, 255, 253, 253, 254, 0, 248, 255], [255, 255, 254, 254, 253, 253, 253, 252, 255, 0, 2, 253, 253], [254, 255, 253, 255, 255, 251, 0, 1, 0, 3, 253, 255, 253], [254, 250, 255, 255, 255, 255, 0, 5, 4, 0, 0, 252, 254], [255, 255, 254, 252, 255, 254, 254, 255, 255, 0, 3, 254, 253], [254, 250, 255, 254, 254, 254, 253, 250, 251, 255, 0, 255, 255], [255, 255, 253, 255, 255, 252, 253, 255, 255, 4, 3, 251, 251], [255, 255, 252, 254, 254, 4, 0, 1, 4, 0, 2, 255, 254], [254, 254, 255, 252, 254, 0, 0, 2, 5, 0, 255, 250, 254], [255, 255, 254, 254, 255, 254, 255, 254, 255, 253, 253, 252, 251], [255, 255, 255, 255, 255, 255, 254, 254, 252, 255, 253, 255, 254]],'b':[[254, 255, 255, 255, 254, 255, 253, 255, 255, 254, 255, 255, 253], [255, 252, 251, 253, 252, 255, 254, 252, 255, 255, 255, 252, 255], [253, 255, 255, 252, 255, 255, 252, 255, 255, 250, 255, 255, 255], [255, 253, 0, 1, 252, 252, 255, 252, 253, 255, 253, 254, 255], [255, 251, 4, 0, 255, 252, 255, 254, 255, 253, 255, 253, 251], [253, 255, 0, 5, 254, 254, 255, 253, 249, 250, 255, 255, 253], [253, 255, 4, 1, 3, 0, 1, 0, 9, 254, 250, 249, 255], [254, 253, 2, 1, 0, 3, 0, 5, 0, 1, 255, 249, 253], [253, 251, 4, 0, 4, 255, 255, 252, 1, 0, 3, 255, 252], [255, 255, 0, 4, 250, 249, 255, 255, 255, 0, 0, 254, 254], [252, 254, 0, 5, 254, 255, 252, 252, 255, 5, 0, 255, 255], [254, 253, 4, 0, 255, 251, 250, 255, 254, 1, 2, 255, 254], [254, 255, 0, 0, 2, 255, 254, 252, 3, 0, 1, 253, 255], [248, 253, 1, 4, 2, 0, 2, 4, 1, 0, 255, 253, 255], [255, 255, 4, 1, 253, 2, 4, 0, 13, 249, 254, 255, 252], [249, 255, 254, 251, 255, 253, 254, 253, 254, 255, 253, 255, 251], [255, 254, 255, 251, 255, 255, 253, 252, 252, 255, 255, 255, 255]],'c':[[254, 255, 255, 255, 255, 254, 254, 255, 255, 255, 254, 255, 253], [255, 255, 251, 254, 255, 255, 255, 255, 254, 255, 254, 254, 254], [255, 255, 255, 252, 255, 251, 254, 254, 255, 253, 255, 254, 255], [254, 251, 255, 255, 254, 255, 251, 254, 253, 255, 254, 254, 255], [255, 255, 252, 254, 255, 250, 255, 253, 255, 248, 255, 255, 255], [255, 255, 255, 252, 251, 255, 255, 251, 255, 254, 255, 255, 250], [249, 255, 255, 252, 7, 0, 0, 2, 0, 255, 251, 255, 255], [255, 252, 253, 7, 0, 3, 0, 0, 0, 255, 255, 254, 254], [254, 255, 1, 5, 2, 254, 254, 254, 255, 249, 255, 255, 254], [252, 255, 0, 6, 247, 255, 252, 255, 253, 254, 254, 254, 255], [255, 250, 0, 0, 255, 255, 252, 255, 254, 255, 251, 253, 255], [254, 252, 4, 1, 252, 255, 252, 250, 251, 254, 255, 255, 255], [250, 255, 0, 4, 0, 250, 254, 255, 255, 250, 255, 254, 249], [255, 255, 254, 0, 1, 0, 2, 0, 0, 252, 254, 255, 255], [254, 255, 252, 255, 3, 0, 0, 3, 2, 255, 252, 255, 255], [248, 255, 252, 253, 254, 255, 255, 255, 253, 255, 255, 255, 250], [255, 255, 254, 251, 255, 253, 252, 254, 255, 253, 255, 255, 254]],'m':[[254, 253, 255, 252, 255, 252, 255, 255, 255, 255, 253, 255, 255], [255, 255, 252, 255, 252, 255, 253, 254, 252, 255, 255, 252, 255], [255, 255, 255, 253, 255, 254, 254, 255, 253, 255, 254, 254, 255], [254, 253, 254, 255, 255, 254, 251, 253, 255, 255, 253, 255, 253], [254, 255, 255, 251, 254, 254, 253, 253, 253, 252, 254, 253, 255], [255, 250, 255, 255, 255, 255, 252, 255, 254, 254, 255, 255, 255], [255, 255, 0, 8, 253, 0, 7, 0, 5, 251, 250, 255, 254], [254, 255, 1, 0, 2, 9, 1, 1, 1, 4, 1, 255, 255], [255, 253, 6, 0, 1, 254, 255, 255, 3, 0, 1, 255, 252], [255, 251, 1, 0, 255, 255, 249, 254, 0, 3, 255, 250, 255], [254, 253, 2, 1, 252, 254, 252, 255, 3, 0, 255, 254, 252], [255, 255, 0, 1, 255, 252, 255, 253, 0, 7, 253, 249, 255], [254, 251, 4, 0, 250, 254, 255, 254, 2, 0, 255, 255, 252], [255, 255, 2, 3, 254, 255, 254, 255, 4, 0, 255, 253, 255], [254, 255, 0, 0, 255, 253, 253, 255, 1, 0, 255, 254, 248], [255, 254, 255, 255, 253, 255, 255, 255, 253, 255, 253, 255, 255], [255, 253, 251, 252, 254, 254, 254, 255, 254, 255, 255, 254, 254]],'n':[[254, 255, 253, 252, 255, 255, 252, 255, 254, 255, 253, 255, 255], [255, 253, 255, 255, 252, 252, 255, 255, 255, 255, 255, 255, 254], [255, 254, 255, 255, 254, 255, 250, 253, 251, 255, 255, 254, 255], [255, 255, 253, 255, 253, 255, 255, 255, 255, 254, 250, 255, 252], [254, 255, 255, 252, 255, 254, 254, 253, 251, 255, 254, 255, 255], [255, 254, 255, 253, 253, 255, 254, 255, 255, 254, 254, 252, 253], [254, 254, 7, 0, 255, 254, 0, 0, 0, 5, 254, 255, 251], [253, 255, 0, 1, 1, 0, 8, 0, 4, 0, 1, 252, 254], [254, 255, 0, 4, 2, 0, 251, 255, 245, 0, 1, 250, 254], [253, 254, 0, 2, 0, 255, 254, 252, 252, 1, 0, 255, 252], [252, 251, 5, 0, 253, 254, 255, 251, 255, 2, 1, 253, 255], [255, 250, 2, 6, 250, 255, 250, 255, 250, 0, 2, 255, 249], [247, 255, 0, 0, 254, 253, 255, 254, 255, 2, 0, 255, 255], [250, 255, 3, 1, 255, 255, 252, 255, 250, 6, 1, 254, 253], [255, 252, 3, 0, 255, 254, 251, 253, 254, 0, 0, 255, 255], [253, 255, 253, 255, 253, 255, 255, 255, 253, 255, 255, 251, 253], [255, 253, 251, 251, 254, 251, 255, 254, 254, 255, 252, 253, 255]],'v':[[255, 255, 254, 255, 253, 255, 252, 255, 255, 254, 255, 255, 253], [255, 255, 254, 255, 253, 251, 255, 255, 254, 255, 254, 252, 255], [255, 254, 255, 255, 255, 254, 255, 254, 253, 253, 255, 255, 254], [253, 255, 254, 252, 254, 255, 251, 255, 254, 255, 254, 254, 254], [255, 253, 255, 254, 255, 255, 254, 254, 255, 255, 254, 255, 255], [255, 255, 254, 248, 254, 250, 254, 255, 255, 250, 255, 252, 252], [252, 255, 252, 255, 254, 255, 252, 253, 255, 255, 1, 253, 253], [254, 255, 253, 253, 6, 0, 254, 250, 255, 0, 1, 255, 253], [253, 252, 255, 253, 1, 0, 255, 254, 251, 3, 0, 255, 252], [253, 252, 251, 255, 0, 3, 254, 251, 255, 3, 1, 252, 255], [255, 255, 254, 253, 255, 0, 0, 255, 0, 1, 255, 254, 251], [255, 251, 252, 251, 248, 1, 0, 4, 1, 2, 254, 254, 255], [255, 252, 254, 255, 255, 0, 3, 0, 3, 0, 255, 249, 253], [254, 254, 253, 255, 254, 254, 4, 0, 0, 255, 251, 255, 255], [255, 255, 255, 255, 255, 252, 2, 0, 1, 248, 255, 254, 248], [255, 253, 255, 254, 255, 255, 255, 252, 255, 255, 252, 252, 254], [255, 255, 254, 255, 255, 253, 255, 254, 254, 251, 255, 255, 252]],'x':[[255, 255, 255, 255, 253, 255, 253, 255, 255, 255, 255, 255, 254], [253, 255, 254, 255, 254, 255, 255, 255, 252, 255, 255, 251, 255], [255, 253, 255, 252, 255, 255, 250, 255, 255, 255, 255, 255, 252], [255, 254, 254, 253, 253, 255, 254, 255, 253, 253, 254, 254, 255], [254, 255, 253, 255, 254, 250, 252, 255, 255, 255, 253, 255, 255], [250, 255, 253, 252, 254, 255, 254, 254, 252, 255, 255, 251, 255], [255, 252, 0, 4, 254, 251, 255, 4, 2, 255, 250, 255, 253], [251, 252, 5, 0, 255, 254, 254, 0, 3, 255, 255, 251, 254], [255, 249, 255, 9, 0, 251, 14, 0, 255, 255, 254, 255, 255], [251, 255, 252, 253, 0, 4, 0, 255, 254, 253, 251, 251, 255], [252, 255, 254, 254, 5, 3, 5, 255, 248, 255, 255, 255, 255], [255, 252, 254, 252, 1, 4, 0, 255, 253, 255, 249, 251, 255], [254, 255, 252, 6, 1, 250, 1, 1, 255, 251, 255, 255, 253], [252, 255, 1, 0, 255, 255, 255, 3, 5, 251, 255, 252, 255], [255, 252, 4, 2, 254, 251, 253, 2, 0, 254, 255, 253, 253], [255, 251, 254, 255, 254, 255, 252, 255, 255, 255, 252, 254, 254], [255, 253, 252, 252, 253, 255, 253, 251, 255, 253, 254, 255, 251]],'z':[[255, 255, 255, 254, 255, 254, 255, 255, 255, 255, 255, 254, 255], [254, 254, 255, 255, 255, 254, 255, 253, 255, 255, 255, 254, 254], [255, 255, 252, 253, 252, 255, 255, 255, 255, 252, 255, 255, 255], [255, 255, 252, 255, 254, 248, 255, 250, 254, 255, 249, 255, 254], [255, 253, 255, 254, 255, 255, 255, 253, 253, 254, 254, 254, 254], [253, 253, 255, 252, 250, 250, 251, 253, 255, 254, 251, 255, 255], [255, 254, 0, 3, 6, 4, 9, 0, 0, 255, 252, 251, 254], [253, 253, 2, 0, 0, 3, 0, 1, 1, 250, 255, 253, 254], [253, 255, 254, 252, 255, 4, 0, 1, 255, 254, 251, 255, 255], [255, 255, 254, 253, 255, 2, 0, 254, 254, 252, 255, 253, 255], [253, 247, 255, 252, 4, 6, 252, 255, 255, 254, 255, 253, 252], [255, 255, 252, 9, 0, 254, 250, 250, 252, 254, 255, 255, 253], [255, 254, 0, 0, 5, 254, 255, 255, 255, 254, 253, 254, 251], [255, 252, 3, 4, 3, 0, 0, 1, 0, 254, 254, 254, 255], [248, 255, 3, 0, 2, 1, 1, 0, 1, 255, 252, 254, 255], [255, 250, 255, 254, 254, 255, 255, 255, 254, 253, 254, 255, 249], [252, 253, 255, 253, 254, 255, 252, 253, 255, 255, 255, 255, 255]],}
```
`Convert.py`è½¬æ¢ä¸ºç°åº¦å›¾å¹¶é™å™ª

```python
import cv2
import numpy as np

class Convert(object):
    """docstring for Convert"""
    def __init__(self):
        super(Convert, self).__init__()
    
    def _get_dynamic_binary_image(self,img):
        '''
        è‡ªé€‚åº”é˜€å€¼äºŒå€¼åŒ–
        '''
        img = cv2.imdecode(np.frombuffer(img, np.uint8), cv2.IMREAD_COLOR)
        img = cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)
        th1 = cv2.adaptiveThreshold(img, 255, cv2.ADAPTIVE_THRESH_GAUSSIAN_C, cv2.THRESH_BINARY, 21, 1)
        return th1

    def clear_border(self,img):
        '''å»é™¤è¾¹æ¡†
        '''
        h, w = img.shape[:2]
        for y in range(0, w):
            for x in range(0, h):
              # if y ==0 or y == w -1 or y == w - 2:
              if y < 4 or y > w -4:
                img[x, y] = 255
              # if x == 0 or x == h - 1 or x == h - 2:
              if x < 4 or x > h - 4:
                img[x, y] = 255
        return img

    def interference_line(self,img):
        '''
        å¹²æ‰°çº¿é™å™ª
        '''
        h, w = img.shape[:2]
        # ï¼ï¼ï¼opencvçŸ©é˜µç‚¹æ˜¯åçš„
        # img[1,2] 1:å›¾ç‰‡çš„é«˜åº¦ï¼Œ2ï¼šå›¾ç‰‡çš„å®½åº¦
        for y in range(1, w - 1):
            for x in range(1, h - 1):
              count = 0
              if img[x, y - 1] > 245:
                count = count + 1
              if img[x, y + 1] > 245:
                count = count + 1
              if img[x - 1, y] > 245:
                count = count + 1
              if img[x + 1, y] > 245:
                count = count + 1
              if count > 2:
                img[x, y] = 255
        return img

    def interference_point(self,img, x = 0, y = 0):
        """ç‚¹é™å™ª
        9é‚»åŸŸæ¡†,ä»¥å½“å‰ç‚¹ä¸ºä¸­å¿ƒçš„ç”°å­—æ¡†,é»‘ç‚¹ä¸ªæ•°
        :param x:
        :param y:
        :return:
        """
        # todo åˆ¤æ–­å›¾ç‰‡çš„é•¿å®½åº¦ä¸‹é™
        cur_pixel = img[x,y]# å½“å‰åƒç´ ç‚¹çš„å€¼
        height,width = img.shape[:2]

        for y in range(0, width - 1):
          for x in range(0, height - 1):
            if y == 0:  # ç¬¬ä¸€è¡Œ
                if x == 0:  # å·¦ä¸Šé¡¶ç‚¹,4é‚»åŸŸ
                    # ä¸­å¿ƒç‚¹æ—è¾¹3ä¸ªç‚¹
                    sum = int(cur_pixel) \
                          + int(img[x, y + 1]) \
                          + int(img[x + 1, y]) \
                          + int(img[x + 1, y + 1])
                    if sum <= 2 * 245:
                      img[x, y] = 0
                elif x == height - 1:  # å³ä¸Šé¡¶ç‚¹
                    sum = int(cur_pixel) \
                          + int(img[x, y + 1]) \
                          + int(img[x - 1, y]) \
                          + int(img[x - 1, y + 1])
                    if sum <= 2 * 245:
                      img[x, y] = 0
                else:  # æœ€ä¸Šéé¡¶ç‚¹,6é‚»åŸŸ
                    sum = int(img[x - 1, y]) \
                          + int(img[x - 1, y + 1]) \
                          + int(cur_pixel) \
                          + int(img[x, y + 1]) \
                          + int(img[x + 1, y]) \
                          + int(img[x + 1, y + 1])
                    if sum <= 3 * 245:
                      img[x, y] = 0
            elif y == width - 1:  # æœ€ä¸‹é¢ä¸€è¡Œ
                if x == 0:  # å·¦ä¸‹é¡¶ç‚¹
                    # ä¸­å¿ƒç‚¹æ—è¾¹3ä¸ªç‚¹
                    sum = int(cur_pixel) \
                          + int(img[x + 1, y]) \
                          + int(img[x + 1, y - 1]) \
                          + int(img[x, y - 1])
                    if sum <= 2 * 245:
                      img[x, y] = 0
                elif x == height - 1:  # å³ä¸‹é¡¶ç‚¹
                    sum = int(cur_pixel) \
                          + int(img[x, y - 1]) \
                          + int(img[x - 1, y]) \
                          + int(img[x - 1, y - 1])

                    if sum <= 2 * 245:
                      img[x, y] = 0
                else:  # æœ€ä¸‹éé¡¶ç‚¹,6é‚»åŸŸ
                    sum = int(cur_pixel) \
                          + int(img[x - 1, y]) \
                          + int(img[x + 1, y]) \
                          + int(img[x, y - 1]) \
                          + int(img[x - 1, y - 1]) \
                          + int(img[x + 1, y - 1])
                    if sum <= 3 * 245:
                      img[x, y] = 0
            else:  # yä¸åœ¨è¾¹ç•Œ
                if x == 0:  # å·¦è¾¹éé¡¶ç‚¹
                    sum = int(img[x, y - 1]) \
                          + int(cur_pixel) \
                          + int(img[x, y + 1]) \
                          + int(img[x + 1, y - 1]) \
                          + int(img[x + 1, y]) \
                          + int(img[x + 1, y + 1])

                    if sum <= 3 * 245:
                      img[x, y] = 0
                elif x == height - 1:  # å³è¾¹éé¡¶ç‚¹
                    sum = int(img[x, y - 1]) \
                          + int(cur_pixel) \
                          + int(img[x, y + 1]) \
                          + int(img[x - 1, y - 1]) \
                          + int(img[x - 1, y]) \
                          + int(img[x - 1, y + 1])

                    if sum <= 3 * 245:
                      img[x, y] = 0
                else:  # å…·å¤‡9é¢†åŸŸæ¡ä»¶çš„
                    sum = int(img[x - 1, y - 1]) \
                          + int(img[x - 1, y]) \
                          + int(img[x - 1, y + 1]) \
                          + int(img[x, y - 1]) \
                          + int(cur_pixel) \
                          + int(img[x, y + 1]) \
                          + int(img[x + 1, y - 1]) \
                          + int(img[x + 1, y]) \
                          + int(img[x + 1, y + 1])
                    if sum <= 4 * 245:
                      img[x, y] = 0
        return img 

    def run(self,img):
        # è‡ªé€‚åº”é˜ˆå€¼äºŒå€¼åŒ–
        img = self._get_dynamic_binary_image(img)
        # å»é™¤è¾¹æ¡†
        img = self.clear_border(img)
        # å¯¹å›¾ç‰‡è¿›è¡Œå¹²æ‰°çº¿é™å™ª
        img = self.interference_line(img)
        # å¯¹å›¾ç‰‡è¿›è¡Œç‚¹é™å™ª
        img = self.interference_point(img)
        return img
```

`ImgMain.py`è¯†åˆ«ä»£ç 

```python
#!/usr/bin/python 
# -*- coding: utf-8 -*-

from fnmatch import fnmatch
from queue import Queue
import matplotlib.pyplot as plt
import cv2
import time
import os
from Convert import Convert
from CharMap import charMap
import requests
import numpy as np



def cutting_img(im,im_position,xoffset = 1,yoffset = 1):
    # è¯†åˆ«å‡ºçš„å­—ç¬¦ä¸ªæ•°
    im_number = len(im_position[1])
    if(im_number>=4): im_number = 4;

    imgArr = []
    # åˆ‡å‰²å­—ç¬¦
    for i in range(im_number):
        im_start_X = im_position[1][i][0] - xoffset
        im_end_X = im_position[1][i][1] + xoffset
        im_start_Y = im_position[2][i][0] - yoffset
        im_end_Y = im_position[2][i][1] + yoffset
        cropped = im[im_start_Y:im_end_Y, im_start_X:im_end_X]
        imgArr.append(cropped)
        # cv2.imwrite(str(i)+"v.jpg",cropped) # æŸ¥çœ‹åˆ‡å‰²æ•ˆæœ
    return im_number,imgArr



def main():
    cvt = Convert()
    req = requests.get("http://xxxxxxxxxxxxxxxx/verifycode.servlet")   
    # æ³¨æ„æœ‰äº›æ•™åŠ¡åŠ è£…äº†æ‰€è°“äº‘é˜²æŠ¤ï¼Œæ²¡æœ‰è¯·æ±‚å¤´ä¼šæ‹¦æˆªï¼Œå¯¼è‡´è·å–ä¸äº†éªŒè¯ç å›¾ç‰‡ï¼ŒæŠ¥é”™å¯ä»¥æ‰“å°req.contentçœ‹çœ‹
    img = cvt.run(req.content)
    cv2.imwrite("v.jpg",img) # æŸ¥çœ‹éªŒè¯ç 

    #åˆ‡å‰²çš„ä½ç½®
    im_position = ([8, 7, 6, 9], [[4, 12], [14, 21], [24, 30], [34, 43]], [[7, 16], [7, 16], [7, 16], [7, 16]])

    cutting_img_num,imgArr = cutting_img(img,im_position,1,1)

    # è¯†åˆ«éªŒè¯ç 
    result=""
    for i in range(cutting_img_num):
        try:
          template = imgArr[i]
          tempResult=""
          matchingDegree=0.0
          for char in charMap:
            img = np.asarray(charMap[char],dtype = np.uint8)
            res = cv2.matchTemplate(img,template,3) #imgåŸå›¾ templateæ¨¡æ¿   ç”¨æ¨¡æ¿åŒ¹é…åŸå›¾
            min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(res)
            if(max_val>matchingDegree):
              tempResult=char
              matchingDegree=max_val
          result += tempResult
          matchingDegree=0.0
        except Exception as err:
          raise Exception
          # print("ERROR "+ str(err))
          pass

    print(result)


if __name__ == '__main__':
  main()
```

æä¾›å…¨éƒ¨ä»£ç 
[https://github.com/WindrunnerMax/SWVerifyCode](https://github.com/WindrunnerMax/SWVerifyCode)
