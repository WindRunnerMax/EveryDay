# 从零设计实现富文本编辑器
富文本编辑器是允许用户在输入和编辑文本内容时，可以应用不同的格式、样式等功能，例如图文混排等，具有所见即所得的能力。与简单的纯文本编辑组件`<input>`等不同，富文本编辑器提供了更多的功能和灵活性，让用户可以创建更丰富和结构化的内容。现代的富文本编辑器也已经不仅限于文字和图片，还包括视频、表格、代码块、思维导图、附件、公式、格式刷等等比较复杂的功能。

- 开源地址: <https://github.com/WindRunnerMax/QuillBlocks>
- 项目笔记: <https://github.com/WindRunnerMax/QuillBlocks/blob/master/NOTE.md>

## Why?
那么为什么要从零设计实现新的富文本编辑器，因为当前已经有很多优秀的编辑器实现。例如极具表现力的数据结构设计`Quill`、结合`React`视图层的`Draft`、纯粹的编辑器引擎`Slate`、高度模块化的`PromiseMirror`、开箱即用的`TinyMCE/TipTap`、集成协同解决方案的`EtherPad`等等。

而我前段时间都在专注于编辑器的应用层实现，在具体实现的过程中也遇到了很多问题，并且记录了相关文章。然而在应用层实现的过程中，遇到了很多我个人觉得可以优化的地方，特别是在数据结构层面上，希望能够将我的一些想法应用出来。举例来说，主要有下面的几个原因:

## 编辑器专栏

从小白开始记录的文章，记录的内容很多，基本上是想到什么就写什么，毕竟是作为平时学习的记录。然后在`24`年写了比较多的富文本编辑器的文章，主要是整理了平时遇到的问题以及解决方案，集中在应用层的设计上，例如:

- [初探富文本之文档虚拟滚动](https://github.com/WindRunnerMax/EveryDay/blob/master/RichText/初探富文本之文档虚拟滚动.md)
- [初探富文本之OT协同算法](https://github.com/WindRunnerMax/EveryDay/blob/master/RichText/初探富文本之OT协同算法.md)
- ...

此外，这段时间还研究了`slate`富文本编辑器相关的实现，并且也给`slate`的仓库提过一些`PR`。还写了一些`slate`相关的文章，同样也是比较关注于应用层的实现，例如:

- [WrapNode数据结构与操作变换](https://github.com/WindRunnerMax/EveryDay/blob/master/RichText/WrapNode数据结构与操作变换.md)
- [Node节点与Path路径映射](https://github.com/WindRunnerMax/EveryDay/blob/master/RichText/Node节点与Path路径映射.md)
- ...



### 深入编辑器

零宽字符

选区末尾

块级结构选择效果

### 数据结构设计
数据结构设计 
slate数据设计尽可能倾向于`HTML`的设计，
Piece Table 
此外在`0.50`之前的版本`API`设计非常复杂，需要比较大的理解成本，虽然
normalize 很复杂，特别是脏路径标记

视图相关

协同相关

## 方案选型
实现`ContentEditable`的编辑器

### execCommand
<div contenteditable></div>

```plain
data:text/html,<div contenteditable style="border: 1px solid black"></div>
```
https://github.com/jaredreich/pell

### ContentEditable

### Canvas


## 每日一题

- <https://github.com/WindRunnerMax/EveryDay>


## 参考
- <https://github.com/w3c/editing>
- <https://zhuanlan.zhihu.com/p/407713779>
- <https://zhuanlan.zhihu.com/p/425265438>
- <https://zhuanlan.zhihu.com/p/259387658>
- <https://www.zhihu.com/question/38699645>
- <https://www.zhihu.com/question/404836496>
- <https://juejin.cn/post/6974609015602937870>
- <https://github.com/yoyoyohamapi/book-slate-editor-design>
- <https://github.com/grassator/canvas-text-editor-tutorial>
- <https://cdacamar.github.io/data%20structures/algorithms/benchmarking/text%20editors/c++/editor-data-structures/>
