# 初探富文本之文档虚拟滚动
虚拟滚动是一种优化长列表性能的技术，其通过按需渲染列表项来提高浏览器运行效率。具体来说，虚拟滚动只渲染用户浏览器视口部分的文档数据，而不是整个文档结构，其核心实现根据可见区域高度和容器的滚动位置计算出需要渲染的列表项，同时不渲染额外的视图内容。虚拟滚动的优势在于可以大大减少`DOM`操作，从而降低渲染时间和内存占用，解决页面加载慢、卡顿等问题，改善用户体验。

## 描述
前段时间用户向我们反馈了一个问题，其产品有比较多的大型文档在我们的文档编辑器上进行编辑，但是因为其文档内容过长且有大量表格，导致在整个编辑的过程中卡顿感比较明显，而且在消费侧展示的时候需要渲染比较长的时间，用户体验不是很好。于是我找了一篇比较大的文档测试了一下，由于这篇文档实在是过大，首屏的`LCP`达到了`6896ms`，即使在各类资源有缓存的情况下`FCP`也需要`4777ms`，单独拎出来首屏的编辑器渲染时间都有`2505ms`，整个应用的`TTI`更是达到了`13343ms`，在模拟极限快速输入的情况下，`FPS`仅仅能够保持在`5+`，所以这个问题还是比较严重的，于是开始了漫长的调研与优化之路。

### 方案调研
在实际调研的过程中，我发现几乎没有关于在线文档编辑的性能优化方案文章，那么对于我来说几乎就是从零开始调研整个方案。当然社区还是有很多关于虚拟滚动的性能优化方案的，这对最终实现整个方案有很大的帮助。此外，我还在想把内容都放在一篇文档里这个行为到底好不好，这跟我们把代码都写在一个文件里是不是没什么区别。

* 渐进式分页加载方案，
* `Canvas`分页加载方案，
* 行级虚拟滚动方案，
* 块级虚拟滚动方案，

### 虚拟滚动
在具体实现之前我思考了一个比较有意思的事情，为什么虚拟滚动能够优化性能。

## 模块设计

### 滚动调度

### 块管理器

### 状态管理

### 选区状态

### 视口锁定

### 快速滚动
快速滚动 与 闲时渲染

## 场景推演

### 锚点跳转

### 搜索替换

### 评论能力

## 性能考量

### 性能指标

### 性能测试

## 每日一题

```
https://github.com/WindrunnerMax/EveryDay
```

## 参考

```
https://arco.design/react/components/list#%E6%97%A0%E9%99%90%E9%95%BF%E5%88%97%E8%A1%A8
```

