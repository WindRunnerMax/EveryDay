# 初探富文本之搜索替换算法
在我们的在线文档系统中，除了基础的富文本编辑能力外，搜索替换的算法同样也是重要的功能实现。纯文本搜索替换算法相对来说是比较容易实现的，而在富文本的场景中，由于存在图文混排、嵌入模块如`Mention`等，实现这一功能则相对要复杂得不少。那么本文则以`Quill`实现的富文本编辑器为基础，通过设计索引查找和图层渲染的方式来实现搜索替换。

## 描述
首先我们先来思考一下纯文本的搜索替换算法，对于纯文本而言我们可以直接通过一些方法来查找对应文本的索引值，然后无论是将其直接替换还是切割再联合的方式，都可以轻松地完成这个功能。而富文本本质上可以看作是携带着格式的纯文本，那么在这种情况下我们依然可以延续着对于纯文本的处理思路，只不过由于存在文本会被切割为多个片段的问题，就需要我们来兼容这个数据层面上的问题。

实际上在前边我们强调了当前的实现是以`Quill`为基础实现的方案，因为本质上搜索替换与数据结构的实现强相关，`quill-delta`是扁平的数据结构，相对来说比较方便我们来处理这个问题。而如果是嵌套的数据结构类型例如`Slate`的实现，我们仍然可以依照这个思路来实现，只不过在这里如果我们将其作为`DEMO`来实现并没有那么直观，嵌套的数据结构类型对于替换的处理上也会复杂很多。

那么在这里我们先来构造`Quill`的编辑器实例，在我们实现的实例中，我们只需要引用`quill.js`的资源，然后指定实例化的`DOM`节点即可初始化编辑器，我们在这里通过配置来注册了样式模块。

```html
<div class="editor-container">
    <div id="$editor"></div>
</div>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
const editor = new Quill($editor, {
  modules: {
    toolbar: [[{ header: [1, 2, false] }], ["bold", "italic", "underline"], ["code-block"]],
  },
  placeholder: "Enter Text...",
  theme: "snow",
});
</script>
```

在`Quill`中是使用`quill-delta`来描述富文本内容的，`quill-delta`是一个扁平的数据结构，除了能描述富文本内容之外，还可以描述富文本内容的变更。在这里我们首先关注的是文档内容的描述，因此这里我们则是全部以`insert`的形式来描述，而之前我们也提到了富文本实际上就是纯文本携带属性，因此我们可以很轻松地使用下面的样式描述普通文本与加粗文本。

```js
const delta = new Delta([
  { insert: "Hello", attributes: { bold: true } },
  { insert: " World" },
]);
```

编辑器实例与插件 查找的是数据描述，attributes 也存在数据

## 搜索算法
对比多种搜索算法
构建虚拟图层
Void/Embed结构处理

## 批量替换
构建数据变更

## 每日一题

```
https://github.com/WindrunnerMax/EveryDay
```

## 参考

```
https://quilljs.com/docs/delta
https://www.npmjs.com/package/quill-delta/v/4.2.2
https://developer.mozilla.org/zh-CN/docs/Web/API/Document/createRange
```
